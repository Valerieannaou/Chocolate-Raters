<div class="row-fluid">
  <div class="span5">
    <%= render partial: 'shared/chocolate_profile', locals: {student: @chocolate} %>
    <% if current_user %>
        <% if @chocolate.user_id != current_user.id %>
            <p><%= link_to 'Rate Chocolate',  rate_chocolate_chocolates_path(:chocolate_id => @chocolate.id) %></p>
        <% end %>

    <% else %>
        <p><%= link_to 'Rate Chocolate', rate_chocolate_chocolates_path(:chocolate_id => @chocolate.id) %></p>
    <% end %>
    <P>
      <% if can? :edit , @chocolate %>
          <%= link_to 'Edit', edit_chocolate_path(@chocolate) %> |
      <% end %>
      <%= link_to 'Back', chocolates_path %> <% if can? :delete , @chocolate %>|
          <%= link_to 'Destroy', @chocolate, method: :delete, data: { confirm: 'Are you sure?' } %>
      <% end %>

    </P>
  </div>

  <div class="span7" id="rating-chocolate">
    <div class="row-fluid">
      <div class="span6" id="rating-chocolate-price">
        <% total_rate = number_with_precision @chocolate.ratings.average(:rate), :precision => 2 %>
        <% rate = total_rate.to_s.split(".") %>
        <div id="rating-chocolate-price-inner">
          <span class="before-point"><%= rate[0] %></span><span class="after-point">.<%= rate[1] %></span>
        </div>
      </div>
      <div class="span6" id="rating-chocolate-remark">
        <div class="chocolate-rating">

          <div class="rating-category">Look</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
          <%= number_with_precision @chocolate.ratings.average(:look), :precision => 2 %>
          </div>
          <div class="divide-by">/5</div>
        </div>
        <div class="chocolate-rating">
          <div class="rating-category">Smell</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
          <%= number_with_precision @chocolate.ratings.average(:smell), :precision => 2 %>
            </div>
          <div class="divide-by">/5</div>
        </div>
        <div class="chocolate-rating">
          <div class="rating-category">Snap</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
            <%= number_with_precision @chocolate.ratings.average(:snap), :precision => 2 %>
          </div>
          <div class="divide-by">/5</div>
        </div>
        <div class="chocolate-rating">
          <div class="rating-category">Mouthfeel</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
          <%= number_with_precision @chocolate.ratings.average(:mouthfeel), :precision => 2 %>
            </div>
          <div class="divide-by">/5</div>
        </div>
        <div class="chocolate-rating">
          <div class="rating-category">Taste</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
            <%= number_with_precision @chocolate.ratings.average(:taste), :precision => 2 %>
          </div>
          <div class="divide-by">/5</div>
        </div>
        <div class="chocolate-rating">
          <div class="rating-category">Aftertaste</div>
          <%= image_tag 'rating-star.png' %>
          <div class="avg_rate">
            <%= number_with_precision @chocolate.ratings.average(:aftertaste), :precision => 2 %>
          </div>
          <div class="divide-by">/5</div>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12" id="chocolate-profile-review">
       <div id="review-header"><h3>Reviews</h3></div>
        <div class="chocolate-reviews">
          <% @reviews= Rating.find_all_by_chocolate_id(@chocolate.id) %>
          <% @reviews.each do |review| %>
              <% user = User.find(review.user_id) %>
              <p><%= link_to user.user_name, user_review_chocolates_path(:user_id => user.id, :chocolate_id => @chocolate.id) %></p>
              </br>
              <P style="margin-left: 20px"><span style="font-size: 20px"><%= review.rate %> </span> <%= review.comment %></P>
          <% end %>
        </div>

      </div>
    </div>
  </div>
</div>
<script language="javascript">
    $(document).ready(
            function (){
                $("#pikame").PikaChoose({
                    carousel:true,
                    showCaption:false,
//                    text: { previous: "< previous", next: "next >", loading: "Loading..." },
                    autoPlay: false
                });
            });
</script>



